[2024-09-18 20:59:43,654][main.py][line:114][INFO] start training on GPU 3!
[2024-09-18 20:59:43,654][main.py][line:115][INFO] Namespace(seed=321, no_cuda=False, pretrained_model='meta-llama/Meta-Llama-3-8B', world_model='meta-llama/Meta-Llama-3-8B', wandb=False, topk=20, fp16=False, step=2, input_file='./data/lexical/commongen_data/test.multi.constraint.json', load_checkpoint_path=None, test_only=False, epochs=1, use_4bit=True, use_lora=True, accumulate_grad_batches=4, buffer_size=50, use_buffer_prob=0.5, n_samples=10, ll_weight=1.5, task='blocksworld', PG=False, batch_size=1, logZ_init=5, reward_temp_start=1.0, reward_temp_end=2.0, epsilon_start=0.3, epsilon_end=0.01, pf_temp_start=4.0, pf_temp_end=1.0, pf_temp_prob=0.5, p_buffer_start=0.25, p_buffer_end=0.5, lr=0.0001, logZ_lr=1e-05, num_iters=10000, mode='train')
[2024-09-18 20:59:55,135][utils.py][line:145][INFO] Note: detected 255 virtual cores but NumExpr set to maximum of 64, check "NUMEXPR_MAX_THREADS" environment variable.
[2024-09-18 20:59:55,136][utils.py][line:148][INFO] Note: NumExpr detected 255 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 8.
[2024-09-18 20:59:55,136][utils.py][line:160][INFO] NumExpr defaulting to 8 threads.
[2024-09-18 20:59:55,269][config.py][line:58][INFO] PyTorch version 2.4.1 available.
[2024-09-18 20:59:55,442][rank_zero.py][line:63][INFO] GPU available: True (cuda), used: True
[2024-09-18 20:59:55,443][rank_zero.py][line:63][INFO] TPU available: False, using: 0 TPU cores
[2024-09-18 20:59:55,443][rank_zero.py][line:63][INFO] HPU available: False, using: 0 HPUs
[2024-09-18 20:59:56,130][cuda.py][line:61][INFO] LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [3]
[2024-09-18 20:59:56,228][model_summary.py][line:104][INFO] 
  | Name         | Type                 | Params | Mode 
--------------------------------------------------------------
0 | model        | PeftModelForCausalLM | 4.6 B  | train
  | other params | n/a                  | 1      | n/a  
--------------------------------------------------------------
56.6 M    Trainable params
4.5 B     Non-trainable params
4.6 B     Total params
18,388.894Total estimated model params size (MB)
2056      Modules in train mode
0         Modules in eval mode
[2024-09-18 21:03:53,591][rank_zero.py][line:63][INFO] `Trainer.fit` stopped: `max_epochs=1` reached.
[2024-09-18 21:03:58,059][profiler.py][line:76][INFO] FIT Profiler Report

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|  Action                                                         	|  Mean duration (s)	|  Num calls      	|  Total time (s) 	|  Percentage %   	|
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|  Total                                                          	|  -              	|  83             	|  242.61         	|  100 %          	|
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|  run_training_epoch                                             	|  237.29         	|  1              	|  237.29         	|  97.805         	|
|  run_training_batch                                             	|  118.58         	|  2              	|  237.17         	|  97.754         	|
|  [Strategy]SingleDeviceStrategy.training_step                   	|  75.99          	|  2              	|  151.98         	|  62.643         	|
|  [LightningModule]BlocksWorldGFNTask.optimizer_step             	|  97.062         	|  1              	|  97.062         	|  40.007         	|
|  [Strategy]SingleDeviceStrategy.backward                        	|  42.431         	|  2              	|  84.861         	|  34.978         	|
|  [LightningDataModule]PromptDataModule.setup                    	|  0.25598        	|  1              	|  0.25598        	|  0.10551        	|
|  [Callback]TQDMProgressBar.on_train_batch_end                   	|  0.060667       	|  2              	|  0.12133        	|  0.050011       	|
|  [Callback]ModelSummary.on_fit_start                            	|  0.022201       	|  1              	|  0.022201       	|  0.0091508      	|
|  [LightningModule]BlocksWorldGFNTask.on_train_epoch_start       	|  0.01163        	|  1              	|  0.01163        	|  0.0047936      	|
|  [Callback]TQDMProgressBar.on_train_epoch_end                   	|  0.0060508      	|  1              	|  0.0060508      	|  0.002494       	|
|  [LightningModule]BlocksWorldGFNTask.configure_optimizers       	|  0.0045743      	|  1              	|  0.0045743      	|  0.0018854      	|
|  [Callback]TQDMProgressBar.on_train_end                         	|  0.0013016      	|  1              	|  0.0013016      	|  0.0005365      	|
|  [_TrainingEpochLoop].train_dataloader_next                     	|  0.00054206     	|  2              	|  0.0010841      	|  0.00044685     	|
|  [Callback]TQDMProgressBar.on_train_start                       	|  0.00074354     	|  1              	|  0.00074354     	|  0.00030647     	|
|  [LightningDataModule]PromptDataModule.train_dataloader         	|  0.00045314     	|  1              	|  0.00045314     	|  0.00018677     	|
|  [LightningModule]BlocksWorldGFNTask.optimizer_zero_grad        	|  0.00044044     	|  1              	|  0.00044044     	|  0.00018154     	|
|  [Callback]TQDMProgressBar.on_train_epoch_start                 	|  0.00018747     	|  1              	|  0.00018747     	|  7.7271e-05     	|
|  [LightningModule]BlocksWorldGFNTask.configure_gradient_clipping	|  0.00016182     	|  1              	|  0.00016182     	|  6.6699e-05     	|
|  [Strategy]SingleDeviceStrategy.batch_to_device                 	|  7.937e-05      	|  2              	|  0.00015874     	|  6.5429e-05     	|
|  [LightningModule]BlocksWorldGFNTask.transfer_batch_to_device   	|  3.51e-05       	|  2              	|  7.02e-05       	|  2.8935e-05     	|
|  [Callback]TQDMProgressBar.on_after_backward                    	|  1.473e-05      	|  2              	|  2.946e-05      	|  1.2143e-05     	|
|  [LightningModule]BlocksWorldGFNTask.on_after_backward          	|  5.4849e-06     	|  2              	|  1.097e-05      	|  4.5215e-06     	|
|  [Callback]ModelSummary.on_train_batch_end                      	|  5.0149e-06     	|  2              	|  1.003e-05      	|  4.1341e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_batch_end         	|  2.74e-06       	|  2              	|  5.4799e-06     	|  2.2587e-06     	|
|  [Callback]TQDMProgressBar.setup                                	|  5.19e-06       	|  1              	|  5.19e-06       	|  2.1392e-06     	|
|  [Callback]TQDMProgressBar.on_before_backward                   	|  2.39e-06       	|  2              	|  4.78e-06       	|  1.9702e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_batch_start       	|  2.38e-06       	|  2              	|  4.76e-06       	|  1.962e-06      	|
|  [Callback]ModelSummary.on_train_end                            	|  4.17e-06       	|  1              	|  4.17e-06       	|  1.7188e-06     	|
|  [Callback]TQDMProgressBar.on_before_zero_grad                  	|  4.0899e-06     	|  1              	|  4.0899e-06     	|  1.6858e-06     	|
|  [Callback]TQDMProgressBar.on_fit_end                           	|  3.8198e-06     	|  1              	|  3.8198e-06     	|  1.5744e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_epoch_end         	|  3.4301e-06     	|  1              	|  3.4301e-06     	|  1.4138e-06     	|
|  [Callback]TQDMProgressBar.on_fit_start                         	|  3.39e-06       	|  1              	|  3.39e-06       	|  1.3973e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_end               	|  3.34e-06       	|  1              	|  3.34e-06       	|  1.3767e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_before_backward         	|  1.6551e-06     	|  2              	|  3.3102e-06     	|  1.3644e-06     	|
|  [Callback]TQDMProgressBar.on_train_batch_start                 	|  1.6e-06        	|  2              	|  3.2e-06        	|  1.319e-06      	|
|  [Callback]TQDMProgressBar.on_before_optimizer_step             	|  2.9099e-06     	|  1              	|  2.9099e-06     	|  1.1994e-06     	|
|  [Strategy]SingleDeviceStrategy.on_train_end                    	|  2.77e-06       	|  1              	|  2.77e-06       	|  1.1417e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_before_batch_transfer   	|  1.33e-06       	|  2              	|  2.6601e-06     	|  1.0964e-06     	|
|  [Callback]ModelSummary.on_train_epoch_end                      	|  2.62e-06       	|  1              	|  2.62e-06       	|  1.0799e-06     	|
|  [Strategy]SingleDeviceStrategy.on_train_batch_start            	|  1.3001e-06     	|  2              	|  2.6003e-06     	|  1.0718e-06     	|
|  [Callback]ModelSummary.on_after_backward                       	|  1.2049e-06     	|  2              	|  2.4098e-06     	|  9.9326e-07     	|
|  [LightningModule]BlocksWorldGFNTask.configure_callbacks        	|  2.2901e-06     	|  1              	|  2.2901e-06     	|  9.4394e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_before_zero_grad        	|  2.0599e-06     	|  1              	|  2.0599e-06     	|  8.4902e-07     	|
|  [Callback]ModelSummary.on_before_backward                      	|  1.02e-06       	|  2              	|  2.0401e-06     	|  8.4087e-07     	|
|  [Callback]ModelSummary.on_train_start                          	|  2.01e-06       	|  1              	|  2.01e-06       	|  8.2849e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_fit_start               	|  1.9199e-06     	|  1              	|  1.9199e-06     	|  7.9135e-07     	|
|  [Callback]ModelSummary.on_train_epoch_start                    	|  1.8901e-06     	|  1              	|  1.8901e-06     	|  7.7906e-07     	|
|  [LightningDataModule]PromptDataModule.teardown                 	|  1.8899e-06     	|  1              	|  1.8899e-06     	|  7.7897e-07     	|
|  [Callback]TQDMProgressBar.teardown                             	|  1.8799e-06     	|  1              	|  1.8799e-06     	|  7.7484e-07     	|
|  [Callback]ModelSummary.setup                                   	|  1.75e-06       	|  1              	|  1.75e-06       	|  7.2129e-07     	|
|  [Callback]ModelSummary.on_before_optimizer_step                	|  1.5299e-06     	|  1              	|  1.5299e-06     	|  6.306e-07      	|
|  [Callback]ModelSummary.on_train_batch_start                    	|  7.5495e-07     	|  2              	|  1.5099e-06     	|  6.2235e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_after_batch_transfer    	|  7.2503e-07     	|  2              	|  1.4501e-06     	|  5.9769e-07     	|
|  [LightningModule]BlocksWorldGFNTask.setup                      	|  1.2999e-06     	|  1              	|  1.2999e-06     	|  5.3579e-07     	|
|  [Callback]ModelSummary.teardown                                	|  1.2901e-06     	|  1              	|  1.2901e-06     	|  5.3176e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_before_optimizer_step   	|  1.2e-06        	|  1              	|  1.2e-06        	|  4.9462e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_start             	|  1.1299e-06     	|  1              	|  1.1299e-06     	|  4.6573e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_fit_end                 	|  1.0799e-06     	|  1              	|  1.0799e-06     	|  4.451e-07      	|
|  [Callback]ModelSummary.on_fit_end                              	|  1.0598e-06     	|  1              	|  1.0598e-06     	|  4.3684e-07     	|
|  [Callback]ModelSummary.on_before_zero_grad                     	|  1.0498e-06     	|  1              	|  1.0498e-06     	|  4.3272e-07     	|
|  [Strategy]SingleDeviceStrategy.on_train_start                  	|  8.9989e-07     	|  1              	|  8.9989e-07     	|  3.7091e-07     	|
|  [LightningModule]BlocksWorldGFNTask.teardown                   	|  8.2003e-07     	|  1              	|  8.2003e-07     	|  3.38e-07       	|
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[2024-09-18 21:03:59,422][cuda.py][line:61][INFO] LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [3]
[2024-09-18 21:04:04,095][profiler.py][line:76][INFO] TEST Profiler Report

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|  Action                                                         	|  Mean duration (s)	|  Num calls      	|  Total time (s) 	|  Percentage %   	|
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|  Total                                                          	|  -              	|  92             	|  248.65         	|  100 %          	|
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|  run_training_epoch                                             	|  237.29         	|  1              	|  237.29         	|  95.431         	|
|  run_training_batch                                             	|  118.58         	|  2              	|  237.17         	|  95.381         	|
|  [Strategy]SingleDeviceStrategy.training_step                   	|  75.99          	|  2              	|  151.98         	|  61.122         	|
|  [LightningModule]BlocksWorldGFNTask.optimizer_step             	|  97.062         	|  1              	|  97.062         	|  39.036         	|
|  [Strategy]SingleDeviceStrategy.backward                        	|  42.431         	|  2              	|  84.861         	|  34.129         	|
|  [LightningDataModule]PromptDataModule.setup                    	|  0.27212        	|  2              	|  0.54425        	|  0.21888        	|
|  [Callback]TQDMProgressBar.on_train_batch_end                   	|  0.060667       	|  2              	|  0.12133        	|  0.048797       	|
|  [Callback]ModelSummary.on_fit_start                            	|  0.022201       	|  1              	|  0.022201       	|  0.0089287      	|
|  [LightningModule]BlocksWorldGFNTask.on_train_epoch_start       	|  0.01163        	|  1              	|  0.01163        	|  0.0046772      	|
|  [Callback]TQDMProgressBar.on_train_epoch_end                   	|  0.0060508      	|  1              	|  0.0060508      	|  0.0024335      	|
|  [LightningModule]BlocksWorldGFNTask.configure_optimizers       	|  0.0045743      	|  1              	|  0.0045743      	|  0.0018397      	|
|  [Callback]TQDMProgressBar.on_train_end                         	|  0.0013016      	|  1              	|  0.0013016      	|  0.00052348     	|
|  [_TrainingEpochLoop].train_dataloader_next                     	|  0.00054206     	|  2              	|  0.0010841      	|  0.000436       	|
|  [Callback]TQDMProgressBar.on_train_start                       	|  0.00074354     	|  1              	|  0.00074354     	|  0.00029903     	|
|  [LightningDataModule]PromptDataModule.train_dataloader         	|  0.00045314     	|  1              	|  0.00045314     	|  0.00018224     	|
|  [LightningModule]BlocksWorldGFNTask.optimizer_zero_grad        	|  0.00044044     	|  1              	|  0.00044044     	|  0.00017713     	|
|  [Callback]TQDMProgressBar.on_train_epoch_start                 	|  0.00018747     	|  1              	|  0.00018747     	|  7.5395e-05     	|
|  [LightningModule]BlocksWorldGFNTask.configure_gradient_clipping	|  0.00016182     	|  1              	|  0.00016182     	|  6.508e-05      	|
|  [Strategy]SingleDeviceStrategy.batch_to_device                 	|  7.937e-05      	|  2              	|  0.00015874     	|  6.3841e-05     	|
|  [LightningModule]BlocksWorldGFNTask.transfer_batch_to_device   	|  3.51e-05       	|  2              	|  7.02e-05       	|  2.8232e-05     	|
|  [Callback]TQDMProgressBar.on_after_backward                    	|  1.473e-05      	|  2              	|  2.946e-05      	|  1.1848e-05     	|
|  [Callback]TQDMProgressBar.setup                                	|  8.14e-06       	|  2              	|  1.628e-05      	|  6.5474e-06     	|
|  [LightningDataModule]PromptDataModule.teardown                 	|  6.2149e-06     	|  2              	|  1.243e-05      	|  4.999e-06      	|
|  [LightningModule]BlocksWorldGFNTask.on_after_backward          	|  5.4849e-06     	|  2              	|  1.097e-05      	|  4.4118e-06     	|
|  [Callback]ModelSummary.on_train_batch_end                      	|  5.0149e-06     	|  2              	|  1.003e-05      	|  4.0337e-06     	|
|  [Callback]TQDMProgressBar.teardown                             	|  3.3599e-06     	|  2              	|  6.7197e-06     	|  2.7025e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_batch_end         	|  2.74e-06       	|  2              	|  5.4799e-06     	|  2.2039e-06     	|
|  [LightningModule]BlocksWorldGFNTask.configure_callbacks        	|  2.4901e-06     	|  2              	|  4.9802e-06     	|  2.0029e-06     	|
|  [Callback]TQDMProgressBar.on_before_backward                   	|  2.39e-06       	|  2              	|  4.78e-06       	|  1.9224e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_batch_start       	|  2.38e-06       	|  2              	|  4.76e-06       	|  1.9143e-06     	|
|  [Callback]ModelSummary.teardown                                	|  2.115e-06      	|  2              	|  4.2301e-06     	|  1.7012e-06     	|
|  [Callback]ModelSummary.on_train_end                            	|  4.17e-06       	|  1              	|  4.17e-06       	|  1.6771e-06     	|
|  [Callback]TQDMProgressBar.on_before_zero_grad                  	|  4.0899e-06     	|  1              	|  4.0899e-06     	|  1.6448e-06     	|
|  [Callback]TQDMProgressBar.on_fit_end                           	|  3.8198e-06     	|  1              	|  3.8198e-06     	|  1.5362e-06     	|
|  [Callback]ModelSummary.setup                                   	|  1.9049e-06     	|  2              	|  3.8098e-06     	|  1.5322e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_epoch_end         	|  3.4301e-06     	|  1              	|  3.4301e-06     	|  1.3795e-06     	|
|  [Callback]TQDMProgressBar.on_fit_start                         	|  3.39e-06       	|  1              	|  3.39e-06       	|  1.3634e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_end               	|  3.34e-06       	|  1              	|  3.34e-06       	|  1.3432e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_before_backward         	|  1.6551e-06     	|  2              	|  3.3102e-06     	|  1.3313e-06     	|
|  [Callback]TQDMProgressBar.on_train_batch_start                 	|  1.6e-06        	|  2              	|  3.2e-06        	|  1.287e-06      	|
|  [Callback]TQDMProgressBar.on_before_optimizer_step             	|  2.9099e-06     	|  1              	|  2.9099e-06     	|  1.1703e-06     	|
|  [Strategy]SingleDeviceStrategy.on_train_end                    	|  2.77e-06       	|  1              	|  2.77e-06       	|  1.114e-06      	|
|  [LightningModule]BlocksWorldGFNTask.setup                      	|  1.36e-06       	|  2              	|  2.7199e-06     	|  1.0939e-06     	|
|  [LightningModule]BlocksWorldGFNTask.on_before_batch_transfer   	|  1.33e-06       	|  2              	|  2.6601e-06     	|  1.0698e-06     	|
|  [Callback]ModelSummary.on_train_epoch_end                      	|  2.62e-06       	|  1              	|  2.62e-06       	|  1.0537e-06     	|
|  [Strategy]SingleDeviceStrategy.on_train_batch_start            	|  1.3001e-06     	|  2              	|  2.6003e-06     	|  1.0457e-06     	|
|  [LightningModule]BlocksWorldGFNTask.teardown                   	|  1.295e-06      	|  2              	|  2.59e-06       	|  1.0416e-06     	|
|  [Callback]ModelSummary.on_after_backward                       	|  1.2049e-06     	|  2              	|  2.4098e-06     	|  9.6915e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_before_zero_grad        	|  2.0599e-06     	|  1              	|  2.0599e-06     	|  8.2842e-07     	|
|  [Callback]ModelSummary.on_before_backward                      	|  1.02e-06       	|  2              	|  2.0401e-06     	|  8.2046e-07     	|
|  [Callback]ModelSummary.on_train_start                          	|  2.01e-06       	|  1              	|  2.01e-06       	|  8.0838e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_fit_start               	|  1.9199e-06     	|  1              	|  1.9199e-06     	|  7.7214e-07     	|
|  [Callback]ModelSummary.on_train_epoch_start                    	|  1.8901e-06     	|  1              	|  1.8901e-06     	|  7.6015e-07     	|
|  [Callback]ModelSummary.on_before_optimizer_step                	|  1.5299e-06     	|  1              	|  1.5299e-06     	|  6.153e-07      	|
|  [Callback]ModelSummary.on_train_batch_start                    	|  7.5495e-07     	|  2              	|  1.5099e-06     	|  6.0724e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_after_batch_transfer    	|  7.2503e-07     	|  2              	|  1.4501e-06     	|  5.8318e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_before_optimizer_step   	|  1.2e-06        	|  1              	|  1.2e-06        	|  4.8261e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_train_start             	|  1.1299e-06     	|  1              	|  1.1299e-06     	|  4.5443e-07     	|
|  [LightningModule]BlocksWorldGFNTask.on_fit_end                 	|  1.0799e-06     	|  1              	|  1.0799e-06     	|  4.3429e-07     	|
|  [Callback]ModelSummary.on_fit_end                              	|  1.0598e-06     	|  1              	|  1.0598e-06     	|  4.2624e-07     	|
|  [Callback]ModelSummary.on_before_zero_grad                     	|  1.0498e-06     	|  1              	|  1.0498e-06     	|  4.2221e-07     	|
|  [Strategy]SingleDeviceStrategy.on_train_start                  	|  8.9989e-07     	|  1              	|  8.9989e-07     	|  3.6191e-07     	|
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------

